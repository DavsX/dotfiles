#!/bin/bash

set -e

sh ~/.xsessionrc
xmodmap ~/.Xmodmap

DP_CONNECTED="$(xrandr | grep -A 1 'DP1 connected')"
if [ "$DP_CONNECTED" ] ; then

    RESOLUTION=$(echo "$DP_CONNECTED" | sed -n 2p | awk '{print $1}')
    HEIGHT=$(echo "$RESOLUTION" | awk -F 'x' '{print $2}')
    DELTA_Y=$(expr $HEIGHT - 900)

    $(xrandr --output LVDS1 --mode 1600x900)

    if [ "$1" = "off" ] ; then
        $(xrandr --output DP1 --off)
    elif [ "$1" = "l" ] || [ "$1" = "left" ] ; then
        $(xrandr --output DP1 --mode $RESOLUTION)
        $(xrandr --output LVDS1 --right-of DP1)
        $(xrandr --output LVDS1 --pos 1920x$DELTA_Y)
    elif [ "$1" = "r" ] || [ "$1" = "right" ] ; then
        $(xrandr --output DP1 --mode $RESOLUTION)
        $(xrandr --output DP1 --right-of LVDS1)
        $(xrandr --output DP1 --pos 1600x-$DELTA_Y)
    fi

    sleep 2
fi

sleep 1
nitrogen --restore
